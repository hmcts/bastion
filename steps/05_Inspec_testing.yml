steps:

- powershell: |
    . { iwr -useb https://omnitruck.chef.io/install.ps1 } | iex; install -project inspec
    echo ($env:path).split(“;”)
    Get-ChildItem -path "C:\Opscode\inspec\bin" -Recurse
  displayName: Inspec Setup

- task: qetza.replacetokens.replacetokens-task.replacetokens@3
  displayName: 'Replace tokens in **/*.*'
  inputs:
    targetFiles: '$(build.artifactstagingdirectory)/**/*.rb'
    tokenPrefix: '__'
    tokenSuffix: '__'

- powershell: |
      echo (az keyvault secret show --vault-name "rdo-uks-bastion-kvs" --name "client-id" --query value -o tsv)
      #echo $(client-secret)
      #echo $(tenant-id)


      $env:AZURE_CLIENT_ID=(az keyvault secret show --vault-name "rdo-uks-bastion-kvs" --name "client-id" --query value -o tsv)
      #$env:AZURE_CLIENT_SECRET=$(client-secret) 
      #$env:AZURE_TENANT_ID=$(tenant-id)
      #C:\\opscode\\inspec\\bin\\inspec.bat exec tests -t azure://

      echo $AZURE_CLIENT_ID
      #echo $AZURE_CLIENT_SECRET
      #echo $AZURE_TENANT_ID
